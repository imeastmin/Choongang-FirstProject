<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<!--/* head('메인 페이지') 수정하면 수정한 타이틀 들어갑니다 */-->
<th:block th:replace="/common/layout.html :: head('쪽지')"></th:block>
<body>
	<table class="table table-striped table-hover" style="width:550px" id="message">
	  	<thead>
	    <tr>
	      <th scope="col" id="msgchk"><div class=col-1><input type="checkbox" onclick="selectAll(this)"></div></th>
	      <td scope="col" id="msgsender">보낸회원</td>
	      <td scope="col" id="msgcontent">내용</td>
	      <td scope="col" id="msgdate">보낸시간</div></td>
	    </tr>
	  	</thead>
  	  	<tbody>
	    <tr>
	      <th scope="col" id="msgchk"><div class=col-1></div></th>
	      <td scope="col" id="msgsender">보낸회원</td>
	      <td scope="col" id="msgcontent">내용</td>
	      <td scope="col" id="msgdate">보낸시간</div></td>
	    </tr>
  	  	
		<!--/* 받은 쪽지가 없을 경우 
	<th:block th:if="${#lists.size("msglist") == 0}">
		<tr>
	        <th scope="col" id="msgchk"><div class=col-1></div></th>
	        <td scope="col" id="msgsender"></td>
	        <td scope="col" id="msgcontent">받은 쪽지가 없습니다</td>
	        <td scope="col" id="msgdate"></div></td>
			</td>
		</tr>
		</tbody>
	</th:block>
		*/-->		
		    
		<!--/* 받은 쪽지가 있을 경우 
	<th:block th:if="${#lists.size("msglist") > 0}">
		    <tr th:each="msglist : ${msglist}">
		      	<th scope="col" id="msgchk" ><div class=col-1><input type="checkbox" name='chk' th:value="${msglist.message_num}"></div></th>
		      	<td scope="col" id="msgsender">
		      	<a onclick="msgwritePopup()">
		      	<span class="d-inline-block text-truncate" style="max-width: 100px;" 
		      		th:text=${msglist.message_sender_nick}></span></a></td>
		      	<a href="#">
		      	<td scope="col" id="msgcontent"><span class="d-inline-block text-truncate" style="max-width: 280px;" 
		      		th:text=${msglist.message_content}></span></a></td>
		      	<td scope="col" id="msgdate"><span class="d-inline-block text-truncate" style="max-width: 150px;" 
		      		th:text=${msglist.message_date}></span></td>
		    </tr>
		*/-->	

	  	</tbody>
	</table>
	<div class="fixed-bottom" style="margin-top:10px">
		<!--/* 삭제버튼 */-->	
		<div class="d-flex flex-row justify-content-start">
		<form action="/msgdel" method=post id="msgDel">
			<!--/* 컨트롤러로 전달되는 값 */-->	
			<input type="hidden" id="checklist" name="checklist" th:value=""> 
			<input type="hidden" name="page" th:value="${pg.page}"> 
			<input type="button" class="btn btn-secondary btn-sm" value="삭제">
		</form>
		</div>
		<div class="d-flex flex-row justify-content-center">
			<nav aria-label="Page navigation example">
			  <ul class="pagination">
			    <li class="page-item">
			      <a class="page-link" href="#" aria-label="Previous">
			        <span aria-hidden="true">&laquo;</span>
			      </a>
			    </li>
			    <li class="page-item"><a class="page-link" href="#">1</a></li>
			    <li class="page-item"><a class="page-link" href="#">2</a></li>
			    <li class="page-item"><a class="page-link" href="#">3</a></li>
			    <li class="page-item">
			      <a class="page-link" href="#" aria-label="Next">
			        <span aria-hidden="true">&raquo;</span>
			      </a>
			    </li>
			  </ul>
			</nav>
		</div>
	</div>
	</th:block>
	<script th:inline="javascript">
	// 쪽지 보내기 팝업창
	function msgwritePopup(){
		window.open("/msgwrite?message_sender_num=9901","쪽지보내기","width=580, height=600, top=210, left=710");
		//window.open("/msgwrite?message_sender_num="+${msglist.message_sender_num}","쪽지보내기","width=580, height=600, top=210, left=710");
	}
	
	// 전체선택
	function selectAll(selectAll)  {
		var checkboxes 
		       = document.getElementsByName('chk');
		checkboxes.forEach((checkbox) => {
			checkbox.checked = selectAll.checked;
		});
	}
	
	// 선택된 쪽지 저장하는 메소드
	function chkDel(){
		var checklist = "";
		$("input[name=chk]:checked").each(function(){
			checklist += $(this).val() + "/";
		});
		
		$('#checklist').val(checklist);
	}
	
	// 삭제 버튼 클릭
	$(document).ready(function(){
		$('#msgDel').on('click',function(){
			chkDel();
			console.log($('#checklist').val());
			
			if($("input[name=chk]").is(":checked")){
				console.log("체크있음");
				$('#msgDel').submit();
			}else{
				console.log("체크없음");
				return false;
			}
			
		});
		
		
	});
	</script>
</body>
</html>